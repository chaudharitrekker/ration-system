<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Approve Officer's Ration Requests</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/raiser_approve.css') }}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body>
  <!-- HEADER -->
  <header class="header">
    <div class="logo-section">
      <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo" class="logo" />
    </div>
  </header>

  <!-- BACKGROUND -->
  <div class="background">
    <img src="{{ url_for('static', filename='images/Official-bg.png') }}" alt="Background" class="background-image" />
  </div>

  <!-- CONTENT -->
  <main class="content">
    <h2 class="page-title">Approve Officer's Ration Requests</h2>

    <!-- SEARCH -->
    <form method="GET" class="search-form">
      <input type="text" name="search" class="search-input" placeholder="Search by P.No, Name, Rank, Unit" value="{{ search }}">
      <button type="submit" class="search-btn"><i class="fas fa-search"></i> Search</button>
    </form>

    {% if demands %}
    <table class="ration-table">
      <thead>
        <tr>
          <th>P.No</th>
          <th>Name</th>
          <th>Rank</th>
          <th>Unit</th>
          <th>Ration Type</th>
          <th>View GX File</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="demand-body">
        {% for d in demands %}
        <tr>
          <td>{{ d.employee_number }}</td>
          <td>{{ d.name }}</td>
          <td>{{ d.rank }}</td>
          <td>{{ d.unit }}</td>
          <td>{{ d.ration_type }}</td>
          <td>
            {% if d.rik_gx_file %}
              <a href="{{ url_for('static', filename='uploads/' ~ d.rik_gx_file) }}" target="_blank" class="view-btn">
                <i class="fas fa-file-alt"></i> View GX
              </a>
            {% else %}
              N/A
            {% endif %}
          </td>
          <td>
            <form method="POST" action="{{ url_for('raiser_approve_demands') }}" class="d-inline">
              <input type="hidden" name="demand_id" value="{{ d.id }}">
              <button type="submit" class="approve-btn"><i class="fas fa-check"></i> Approve</button>
            </form>
            <form method="POST" action="{{ url_for('raiser_delete_demand', demand_id=d.id) }}" class="d-inline">
              <button type="submit" class="delete-btn"><i class="fas fa-trash"></i> Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="pagination" id="pagination"></div>
    {% else %}
      <p class="no-data">No pending requests found.</p>
    {% endif %}

    <div class="buttons">
      <a href="{{ url_for('raiser_dashboard') }}" class="back-btn">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
      </a>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    Website Designed and Hosted by HQWNC / CDIT Â©2025. All Rights Reserved.
  </footer>

  <!-- PAGINATION SCRIPT -->
  <script>
    const rowsPerPage = 6;
    const tableBody = document.getElementById("demand-body");
    const rows = tableBody ? [...tableBody.querySelectorAll("tr")] : [];
    const pagination = document.getElementById("pagination");
    let currentPage = 1;

    function renderTable(page) {
      const start = (page - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      rows.forEach((row, index) => {
        row.style.display = (index >= start && index < end) ? "table-row" : "none";
      });
    }

    function renderPagination() {
      if (!pagination) return;
      const totalPages = Math.ceil(rows.length / rowsPerPage);
      pagination.innerHTML = "";

      const prev = document.createElement("button");
      prev.innerHTML = "&lt;";
      prev.disabled = currentPage === 1;
      prev.onclick = () => changePage(currentPage - 1);
      pagination.appendChild(prev);

      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        if (i === currentPage) btn.classList.add("active");
        btn.onclick = () => changePage(i);
        pagination.appendChild(btn);
      }

      const next = document.createElement("button");
      next.innerHTML = "&gt;";
      next.disabled = currentPage === totalPages;
      next.onclick = () => changePage(currentPage + 1);
      pagination.appendChild(next);
    }

    function changePage(page) {
      currentPage = page;
      renderTable(page);
      renderPagination();
    }

    if (rows.length > 0) {
      renderTable(currentPage);
      renderPagination();
    }
  </script>
</body>
</html>