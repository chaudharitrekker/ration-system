{% extends "base.html" %}
{% block title %}Master List{% endblock %}
{% block content %}
<h1 class="mb-4">ðŸ“‹ Master List - Approved Ration Requests</h1>

<!-- ðŸ”Ž Search Form -->
<form method="GET" class="mb-3 d-flex">
    <input type="text" name="search" class="form-control me-2"
           placeholder="Search by P.No, Name, Rank, Unit"
           value="{{ search }}">
    <button type="submit" class="btn btn-primary">Search</button>
</form>

{% if demands %}

<!-- ðŸ”˜ Tabs -->
<ul class="nav nav-tabs mb-3" id="masterTabs" role="tablist">
  <li class="nav-item">
    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#first15">1st 15 Days</button>
  </li>
  <li class="nav-item">
    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#second15">2nd 15 Days</button>
  </li>
  <li class="nav-item">
    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#dry">Dry Issue</button>
  </li>
</ul>

<div class="tab-content">
  <!-- 1st 15 Days -->
  <div class="tab-pane fade show active" id="first15">
    <form method="POST" action="{{ url_for('raise_demand') }}">
      <input type="hidden" name="demand_type" value="first15">
      <table class="table table-bordered table-striped">
        <thead class="table-dark">
          <tr>
            <th>Select</th>
            <th>P.No</th>
            <th>Name</th>
            <th>Rank</th>
            <th>Unit</th>
            <th>Ration Type</th>
            <th>Availability Days (1â€“15)</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody>
          {% for d in demands %}
          <tr>
            <td><input type="checkbox" name="selected_ids" value="{{ d.id }}"></td>
            <td>{{ d.employee_number }}</td>
            <td>{{ d.name }}</td>
            <td>{{ d.rank }}</td>
            <td>{{ d.unit }}</td>
            <td>{{ d.ration_type }}</td>
            <td><input type="number" name="days_{{ d.id }}" class="form-control" min="0" max="15"></td>
            <td>
              <form method="POST" action="{{ url_for('raiser_delete_demand', demand_id=d.id) }}">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <button type="submit" class="btn btn-success">Raise Demand</button>
    </form>
  </div>

  <!-- 2nd 15 Days -->
  <div class="tab-pane fade" id="second15">
    <form method="POST" action="{{ url_for('raise_demand') }}">
      <input type="hidden" name="demand_type" value="second15">
      <table class="table table-bordered table-striped">
        <thead class="table-dark">
          <tr>
            <th>Select</th>
            <th>P.No</th>
            <th>Name</th>
            <th>Rank</th>
            <th>Unit</th>
            <th>Ration Type</th>
            <th>Availability Days (16â€“30)</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody>
          {% for d in demands %}
          <tr>
            <td><input type="checkbox" name="selected_ids" value="{{ d.id }}"></td>
            <td>{{ d.employee_number }}</td>
            <td>{{ d.name }}</td>
            <td>{{ d.rank }}</td>
            <td>{{ d.unit }}</td>
            <td>{{ d.ration_type }}</td>
            <td><input type="number" name="days_{{ d.id }}" class="form-control" min="0" max="15"></td>
            <td>
              <form method="POST" action="{{ url_for('raiser_delete_demand', demand_id=d.id) }}">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <button type="submit" class="btn btn-success">Raise Demand</button>
    </form>
  </div>

  <!-- Dry Issue -->
  <div class="tab-pane fade" id="dry">
    <form method="POST" action="{{ url_for('raise_demand') }}">
      <input type="hidden" name="demand_type" value="dry">
      <table class="table table-bordered table-striped">
        <thead class="table-dark">
          <tr>
            <th>Select</th>
            <th>P.No</th>
            <th>Name</th>
            <th>Rank</th>
            <th>Unit</th>
            <th>Ration Type</th>
            <th>Total Days</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody>
          {% for d in dry_list %}
          <tr>
            <td><input type="checkbox" name="selected_ids" value="{{ d.id }}"></td>
            <td>{{ d.employee_number }}</td>
            <td>{{ d.name }}</td>
            <td>{{ d.rank }}</td>
            <td>{{ d.unit }}</td>
            <td>{{ d.ration_type }}</td>
            <td><input type="number" name="days_{{ d.id }}" class="form-control" min="0" max="30" value="{{ d.dry_days }}"></td>
            <td>
              <form method="POST" action="{{ url_for('raiser_delete_demand', demand_id=d.id) }}">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <button type="submit" class="btn btn-success">Raise Demand</button>
    </form>
  </div>
</div>
{% endif %}
{% endblock %}
